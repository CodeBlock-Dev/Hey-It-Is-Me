@using CodeBlock.DevKit.Contracts.Services
@using CodeBlock.DevKit.Pricing.Dtos
@inherits ActivePlansToOrder
@attribute [ReplaceBaseComponent]
@inject ISettingAccessorService SettingAccessorService

<section class="pricing-section" id="pricing">
    <div class="pricing-container">
        <div class="pricing-header">
            <h2 class="pricing-title">Create Your Fact Page</h2>
            <p class="pricing-description">Buy your plan now and create your page later in your user dashboard.</p>
        </div>

        <div class="pricing-plans">
            @if (StarterPlanDto != null)
            {
                <!-- Starter Plan -->
                <div class="pricing-card starter-plan">
                    <div class="plan-header">
                        <h3 class="plan-title">@StarterPlanDto.DisplayName</h3>
                        <div class="plan-price">
                            <span class="price-current">@($"{SettingAccessorService.Settings.Payment.Currency.Symbol}{StarterPlanDto.EffectiveRecurringPrice.Value.ToFormattedPrice()}")</span>
                            <span class="price-period">/year</span>
                        </div>
                    </div>
                    <div class="plan-description">
                        <p>@StarterPlanDto.Description</p>
                    </div>
                    <div class="plan-features">
                        @((MarkupString)StarterPlanDto.Features)
                    </div>
                    <a href="/payment/order/plan/@StarterPlanDto.Id" class="btn btn-secondary plan-btn">Try Starter</a>
                </div>
            }

            @if (EssentialPlanDto != null)
            {
                <!-- Essential Plan -->
                <div class="pricing-card basic-plan">
                    <div class="plan-header">
                        <h3 class="plan-title">@EssentialPlanDto.DisplayName</h3>
                        <div class="plan-price">
                            <span class="price-current">@($"{SettingAccessorService.Settings.Payment.Currency.Symbol}{EssentialPlanDto.EffectiveRecurringPrice.Value.ToFormattedPrice()}")</span>
                            <span class="price-period">/year</span>
                        </div>
                    </div>
                    <div class="plan-description">
                        <p>@EssentialPlanDto.Description</p>
                    </div>
                    <div class="plan-features">
                        @((MarkupString)EssentialPlanDto.Features)
                    </div>
                    <a href="/payment/order/plan/@EssentialPlanDto.Id" class="btn btn-secondary plan-btn">Choose Essential</a>
                </div>
            }

            @if (PremiumPlanDto != null)
            {
                <!-- Premium Plan -->
                <div class="pricing-card premium-plan">
                    <div class="plan-badge">Most Popular</div>
                    <div class="plan-header">
                        <h3 class="plan-title">@PremiumPlanDto.DisplayName</h3>
                        <div class="plan-price">
                            <span class="price-current">@($"{SettingAccessorService.Settings.Payment.Currency.Symbol}{PremiumPlanDto.EffectiveRecurringPrice.Value.ToFormattedPrice()}")</span>
                            <span class="price-period">/year</span>
                        </div>
                    </div>
                    <div class="plan-description">
                        <p>@PremiumPlanDto.Description</p>
                    </div>
                    <div class="plan-features">
                        @((MarkupString)PremiumPlanDto.Features)
                    </div>
                    <a href="/payment/order/plan/@PremiumPlanDto.Id" class="btn btn-primary plan-btn">Choose Premium</a>
                </div>
            }
        </div>
    </div>
</section>

@code {
    private GetPlanDto StarterPlanDto;
    private GetPlanDto EssentialPlanDto;
    private GetPlanDto PremiumPlanDto;
    
    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        if (base.Plans != null && base.Plans.Any())
        {
            StarterPlanDto = base.Plans.FirstOrDefault(p => p.SystemName == HeyItIsMe.WebApp.Helpers.Constants.STARTER_PLAN);
            EssentialPlanDto = base.Plans.FirstOrDefault(p => p.SystemName == HeyItIsMe.WebApp.Helpers.Constants.ESSENTIAL_PLAN);
            PremiumPlanDto = base.Plans.FirstOrDefault(p => p.SystemName == HeyItIsMe.WebApp.Helpers.Constants.PREMIUM_PLAN);
        }
    }
}